#!/bin/bash

file=$(basename $1)

generate_name() {
    pckname=$1
    arr=(${pckname//-/ })
    name_elements=$(expr ${#arr[@]} - 2)
    name=${arr[0]}

    for i in $(seq 1 $name_elements);
    do
        name="$name-${arr[$i]}"
    done

    echo $name
}

pckname_wver=${file%.t*}
pckname=$(generate_name $pckname_wver)
version="${pckname_wver##*-}"

mkinstall="no"

if [ "$2" == "-i" ]; then
        mkinstall="yes"
elif [ "$2" != "" ]; then
        pckname=$2

	if [ "$3" == "-i" ]; then
		mkinstall="yes"
	fi
fi

pckdir=${pckname:0:1}/$pckname

if [ -d "$pckdir" ]; then
    echo "Package Exists: $pckdir"
    exit -1
fi

mkdir -p packages/$pckdir/files

if [ "$mkinstall" == "yes" ]; then
        mkdir -p packages/$pckdir/install
        touch packages/$pckdir/install/install.sh
fi

echo "name=$pckname" > packages/$pckdir/pck
echo "version=$version" >> packages/$pckdir/pck
echo "source=$file" >> packages/$pckdir/pck

echo "build_inst_pck $pckname" >> added

export editor=code
